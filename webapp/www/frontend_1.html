<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Solax – Live Dashboard (v1 + app.js)</title>
  
  <link rel="stylesheet" href="common.css">
  <!-- Všechny styly nyní v common.css, ale pro přehlednost zde zůstává i základní stylová část -->
  <style>
  :root{
    --bg:#0b0f14; --card:#121822; --muted:#99a3b3; --text:#e8eef7;
    --ok:#1f9d55; --bad:#d64545; --accent:#3b82f6;
    --border:#1d2633; --panel:#0e1420; --panel-border:#263148;
  }
  html,body{ margin:0; background:var(--bg); color:var(--text); font:14px/1.45 system-ui,Segoe UI,Roboto,Arial }

  header{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px 18px; border-bottom:1px solid var(--border) }
  h1{ margin:0; font-size:18px; font-weight:600 } .hdr-meta{ margin-left:10px; color:#c9d7ee; font-weight:500; font-size:14px; opacity:.9 }
  .header-actions{ top:16px; z-index:2001 }

  .small-btn{
    padding:6px 12px; border-radius:8px; border:none; font-weight:700; cursor:pointer; font-size:14px;
    background:#263248; color:#e8eef7; transition:filter .15s;
  }
  .small-btn.ok{ background:var(--ok); color:#fff } .small-btn.bad{ background:var(--bad); color:#fff }
  .small-btn[disabled]{ opacity:.7; cursor:not-allowed }
  .small-btn:hover{ filter:brightness(1.07) }
  .icon-btn{ width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center; border-radius:10px; border:1px solid var(--panel-border); background:var(--panel); cursor:pointer }
  .icon-btn:hover{ background:#141c2b }
  .icon{ width:26px; height:26px } .icon path{ stroke-width:2.2 }

  .grid{ display:grid; gap:16px; padding:16px }
  @media(min-width:900px){ .grid{ grid-template-columns:repeat(3,1fr) } }
  .card{ background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px }
  .card h2{ margin:0 0 12px 0; font-size:16px; color:#dfe7ee }
  .kpi{ display:flex; justify-content:space-between; margin:6px 0 }
  .kpi .label{ color:var(--muted) }
  .bar{ height:10px; background:#0c1116; border:1px solid var(--border) }
  .bar > i, .fill{ background:linear-gradient(90deg,var(--accent),#22c55e) }

  .backdrop{ background: rgba(10,15,25,.35); z-index:1500 }
  .sidepanel{ width:360px; background:var(--card); border-left:1px solid var(--border);
    box-shadow:-4px 0 10px rgba(0,0,0,.3); padding:16px; z-index:2000 }
  legend{ font-weight:700; margin-bottom:10px }
  label{ color:var(--muted); margin-top:10px }
  input,select{
    width:100%; padding:10px 12px; border-radius:8px; border:1px solid #253045;
    background:var(--panel); color:#e8eef7;
  }
  .row{ gap:10px }
</style>



</head>
<body>
  <header>
    <h1>Solax – Live Dashboard <span class="hdr-meta">· <span id="dt">—</span></span></h1>
    <div class="header-actions">
      <a href="" class="icon-btn" title="Dark/Light">&#127767;</a>
      <button id="start" class="small-btn ok" aria-pressed="false">Start</button>
      <button id="stop"  class="small-btn bad" aria-pressed="false" disabled>Stop</button>
      <button id="toggleSettings" class="icon-btn" aria-controls="settingsPanel" aria-expanded="false" title="Nastavení">
        <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 6h16M4 12h16M4 18h16" stroke="#c9d7ee" stroke-linecap="round"/></svg>
      </button>
    </div>
  </header>

  <!-- Backdrop + settings panel (ID přesně podle app.js) -->
  <div id="panelBackdrop" class="backdrop" hidden></div>

  <aside id="settingsPanel" class="sidepanel" hidden>
    <form id="cfg">
      <fieldset>
        <legend>Nastavení</legend>

        <label>API URL (Solax reálné API)
          <input name="apiUrl" placeholder="http://solax-sim nebo http://192.168.x.y" />
        </label>

        <label><input type="checkbox" name="sendPwd" /> Posílat heslo z prohlížeče (nedoporučeno)</label>
        <div id="pwdWrap" style="display:none">
          <label>Heslo / SN (parametr <code>pwd</code>)
            <input name="passwd" type="password" autocomplete="current-password" />
          </label>
        </div>

        <label>Proxy (volitelné, např. http://localhost:8081)
          <input name="proxy" placeholder="http://proxy:port" />
        </label>

        <div class="row">
          <div>
            <label>Interval čtení (s)
              <input name="delay" type="number" min="1" value="4" />
            </label>
          </div>
          <div>
            <label>Debug (0–2)
              <input name="debuglevel" type="number" min="0" max="2" value="1" />
            </label>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Peak String 1 (W)
              <input name="peak1" type="number" min="0" value="4500" />
            </label>
          </div>
          <div>
            <label>Peak String 2 (W)
              <input name="peak2" type="number" min="0" value="0" />
            </label>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Max výkon měniče (W)
              <input name="maxPower" type="number" min="0" value="4500" />
            </label>
          </div>
          <div>
            <label>Max odběr domu (W)
              <input name="maxLoad" type="number" min="0" value="16000" />
            </label>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Max energie baterie (Wh)
              <input name="BatteryMaxCapacity" type="number" min="0" value="10000" />
            </label>
          </div>
        </div>

        <!-- DB ovládání – ID přesně podle app.js -->
        <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap">
          <button type="button" id="btnSaveDb"  class="small-btn" style="border:1px solid var(--line)">Uložit do DB</button>
          <button type="button" id="btnLoadDb" class="small-btn" style="border:1px solid var(--line)">Načíst ze DB</button>
        </div>

        <div id="loadBox" style="display:none; margin-top:10px; padding:10px; border:1px dashed var(--line); border-radius:12px;">
          <label>Vyber uložený systém (SN)
            <select id="cfgList" style="width:100%; padding:8px; border:1px solid var(--line); border-radius:10px;"></select>
          </label>
          <div style="margin-top:10px; display:flex; gap:8px;">
            <button type="button" id="btnLoadSelected" class="small-btn">Načíst</button>
            <button type="button" id="btnLoadCancel"   class="small-btn">Zavřít</button>
          </div>
        </div>
      </fieldset>
    </form>
  </aside>

  <!-- DATA GRID: všechny cílové ID podle app.js -->
  <div class="grid">
    <div class="card" id="card-panels">
      <h2>Panely</h2>
      <div class="kpi"><span class="label">Celkem</span><span><span id="pv-total">0</span> W</span></div>
      <div class="bar"><i id="bar-pv-total" style="width:0%"></i></div>
      <div class="kpi"><span class="label">String 1</span><span><span id="pv-1">0</span> W</span></div>
      <div class="bar"><i id="bar-pv-1" style="width:0%"></i></div>
      <div class="kpi"><span class="label">String 2</span><span><span id="pv-2">0</span> W</span></div>
      <div class="bar"><i id="bar-pv-2" style="width:0%"></i></div>
      <div class="kpi"><span class="label">Výroba DC dnes</span><span><span id="pv-dc-today">0.0</span> kWh</span></div>
    </div>

    <div class="card" id="card-batt">
      <h2>Baterie</h2>
      <div class="kpi"><span class="label">SoC</span><span><span id="batt-soc">0</span> %</span></div>
      <div class="bar"><i id="bar-batt-soc" style="width:0%"></i></div>
      <div class="kpi"><span class="label">Teplota</span><span><span id="batt-temp">0</span> °C</span></div>
      <div class="kpi"><span class="label">Energie (zbývající)</span><span><span id="batt-cap">0.0</span> kWh</span></div>
      <div class="bar"><i id="bar-batt-cap" style="width:0%"></i></div>
      <div class="kpi"><span class="label">Směr</span><span id="batt-power" class="pill">0 W</span></div>
      <div class="kpi"><span class="label">Dnes nabito</span><span><span id="batt-in">0.0</span> kWh</span></div>
      <div class="kpi"><span class="label">Dnes vybito</span><span><span id="batt-out">0.0</span> kWh</span></div>
    </div>

    <div class="card" id="card-inv">
      <h2>Střídač <span id="inv-mode" class="muted"></span></h2>
      <div class="kpi"><span class="label">Teplota</span><span><span id="inv-temp">0</span> °C</span></div>
      <div class="kpi"><span class="label">Výkon</span><span><span id="inv-pwr">0</span> W</span></div>
      <div class="bar"><i id="bar-inv" style="width:0%"></i></div>
      <div class="kpi"><span class="label">L1</span><span id="l1">0 W</span></div>
      <div class="kpi"><span class="label">L2</span><span id="l2">0 W</span></div>
      <div class="kpi"><span class="label">L3</span><span id="l3">0 W</span></div>
      <div class="kpi"><span class="label">AC výroba dnes</span><span><span id="inv-ac-today">0.0</span> kWh</span></div>
    </div>

    <div class="card" id="card-grid">
      <h2>Distribuční síť</h2>
      <div class="kpi"><span class="label">Směr</span><span id="grid-dir" class="pill">0 W</span></div>
      <div class="kpi"><span class="label">Dnes odebráno</span><span><span id="grid-in">0.00</span> kWh</span></div>
      <div class="kpi"><span class="label">Dnes dodáno</span><span><span id="grid-out">0.00</span> kWh</span></div>
    </div>

    <div class="card" id="card-home">
      <h2>Dům</h2>
      <div class="kpi"><span class="label">Aktuální odběr</span><span><span id="home-load">0</span> W</span></div>
      <div class="bar"><i id="bar-home" style="width:0%"></i></div>
      <div class="kpi"><span class="label">Dnes spotřeba</span><span><span id="home-cons">0.0</span> kWh</span></div>
      <div class="kpi"><span class="label">Soběstačnost</span><span class="pill"><span id="self">0</span> %</span></div>
      <div class="bar"><i id="bar-self" style="width:0%"></i></div>
    </div>

    <div class="card">
      <h2>Systém</h2>
      <div class="kpi"><span class="label">Sériové číslo</span><span class="pill" id="sn">—</span></div>
      <div class="kpi"><span class="label">URL</span><span id="meta-url">—</span></div>
      <div class="kpi"><span class="label">Čas</span><span id="meta-time"><span id="dt">—</span></span></div>
    </div>
  </div>

  <!-- VŠECHEN JS je nyní externě -->
  <script src="app.js"></script>
</body>
</html>