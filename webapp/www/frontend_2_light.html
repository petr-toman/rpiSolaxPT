<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Solax – živá telemetrie (Light UI, fixed)</title>

  <link rel="stylesheet" href="common.css">
  <!-- Všechny styly nyní v common.css, ale pro přehlednost zde zůstává i základní stylová část -->
  
  
  <style>
  :root{
    --bg:#f7f9fc; --surface:#fff; --muted:#73819a; --text:#1d2939; --text-dim:#4b5565;
    --border:#e9eef5; --shadow:0 2px 6px rgba(15,23,42,.06), 0 10px 24px rgba(15,23,42,.05);
    --accent:#22c1c3; --accent-2:#7de2d1; --ok:#16a34a; --bad:#ef4444;
    --radius:18px; --bar-track:#eef2f7; --bar-border:#e6ebf2;
  }
  html,body{ margin:0; background:var(--bg); color:var(--text);
    font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans"; }

  header{ position:sticky; top:0; z-index:10; display:flex; align-items:center; justify-content:space-between;
    padding:14px 22px; background:var(--surface); border-bottom:1px solid var(--border); }
  h1{ margin:0; font-size:18px; font-weight:600; color:var(--text-dim) }
  .header-actions{ top:12px; z-index:9999 }

  .small-btn{
    flex:0 0 auto; padding:8px 14px; border-radius:10px; border:1px solid var(--border);
    background:#fff; color:var(--text); font-weight:600; font-size:14px; box-shadow:var(--shadow);
    transition: transform .05s, box-shadow .2s, filter .2s;
  }
  .small-btn.ok{ background:linear-gradient(180deg,#20c997 0%,#10b981 100%); color:#fff; border-color:transparent }
  .small-btn.bad{ background:linear-gradient(180deg,#ef4444 0%,#dc2626 100%); color:#fff; border-color:transparent }
  .small-btn[disabled]{ opacity:.7; cursor:not-allowed }
  .small-btn:hover{ filter:brightness(1.03); transform:translateY(-1px) }

  .icon-btn{
    width:38px; height:38px; flex:0 0 38px; display:inline-flex; align-items:center; justify-content:center;
    border-radius:12px; border:1px solid var(--border); background:#fff; cursor:pointer; box-shadow:var(--shadow);
    transition:transform .05s, box-shadow .2s;
  }
  .icon-btn:hover{ transform:translateY(-1px) }
  .icon{ width:26px; height:26px } .icon path{ stroke:#0f172a; stroke-width:2.2 }

  main{ padding:20px }
  .grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(420px,1fr)); gap:22px }
  .card{ background:var(--surface); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px 18px }
  .card h3{ margin:0 0 12px 0; font-size:15px; font-weight:600; color:var(--text-dim); display:flex; align-items:center; gap:8px }
  .kv{ gap:10px 12px; font-size:14px }
  .dim{ color:var(--muted); font-size:12px }
  .pill{ background:#fff; border:1px solid var(--border); border-radius:999px; padding:4px 10px; box-shadow:var(--shadow) }
  .bar{ height:12px; background:var(--bar-track); border:1px solid var(--bar-border); box-shadow: inset 0 1px 0 rgba(255,255,255,.6) }
  .bar > i{ background: linear-gradient(90deg, var(--accent), var(--accent-2)) }

  /* Backdrop/Sidepanel – světelné barvy + stacking */
  .backdrop{ background: rgba(15,23,42,.18); z-index:3500 }
  .sidepanel{ width:420px; background:var(--surface); border-left:1px solid var(--border);
    padding:18px; box-shadow:-8px 0 24px rgba(15,23,42,.08); z-index:3600 }
  legend{ font-weight:600; color:var(--text-dim) }
  input{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border);
    background:#fff; color:var(--text); box-shadow:var(--shadow);
  }
  .row{ gap:12px }
  @media (max-width:520px){ .grid{ grid-template-columns:1fr } .sidepanel{ width:92vw } .small-btn{ padding:7px 11px; font-size:13px } .icon{ width:24px; height:24px } }
</style>

</head>

<body>
  <header>
    <h1>Solax – živá telemetrie</h1>

    <div class="header-actions">
      <a href="" class="icon-btn" title="Dark/Light">&#127767;</a>
      <button id="start" class="small-btn ok" aria-pressed="false">Start</button>
      <button id="stop"  class="small-btn bad" aria-pressed="false">Stop</button>
      <button id="toggleSettings" class="icon-btn" aria-controls="settingsPanel" aria-expanded="false" title="Nastavení">
        <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </header>

  <main>
    <!-- Backdrop sits above page but below header actions -->
    <div id="panelBackdrop" class="backdrop" hidden></div>

    <!-- Right sliding settings panel -->
    <aside id="settingsPanel" class="sidepanel" hidden>
      <form id="cfg">
        <fieldset>
          <legend>Nastavení</legend>

          <label>API URL (Solax reálné API)
            <input name="apiUrl" placeholder="http://solax-sim" />
          </label>

          <label><input type="checkbox" name="sendPwd" /> Posílat heslo z prohlížeče (nedoporučeno)</label>
          <div id="pwdWrap" style="display:none">
            <label>Heslo k API
              <input name="passwd" type="password" autocomplete="current-password" />
            </label>
          </div>

          <label>Proxy (pokud není Solax http API přímo dostupné)
            <input name="proxy" placeholder="http://some-proxy:3128" />
          </label>

          <div class="row">
            <div>
              <label>Interval čtení (s)
                <input name="delay" type="number" min="1" value="4" />
              </label>
            </div>
            <div>
              <label>Debug (0/1/2)
                <input name="debuglevel" type="number" min="0" max="2" value="1" />
              </label>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Peak String 1 (W)
                <input name="peak1" type="number" min="0" value="4500" />
              </label>
            </div>
            <div>
              <label>Peak String 2 (W)
                <input name="peak2" type="number" min="0" value="0" />
              </label>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Max výkon měniče (W)
                <input name="maxPower" type="number" min="0" value="4500" />
              </label>
            </div>
            <div>
              <label>Max odběr domu (W)
                <input name="maxLoad" type="number" min="0" value="16000" />
              </label>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Max energie baterie (Wh)
                <input name="BatteryMaxCapacity" type="number" min="0" value="10000" />
              </label>
            </div>
          </div>

          <div class="footer">
            Proxy endpoint je napevno <span class="mono">proxy.php</span>. Z bezpečnostních důvodů je lepší, aby <span class="mono">proxy.php</span> heslo doplnila na serveru.
          </div>
                    <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap">
            <button type="button" id="btnSaveDb" class="small-btn" style="border:1px solid var(--border)">Uložit do DB</button>
            <button type="button" id="btnLoadDb" class="small-btn" style="border:1px solid var(--border)">Načíst ze DB</button>
          </div>

          <!-- Malý načítací box pro výběr konfigurace -->
          <div id="loadBox" style="display:none; margin-top:10px; padding:10px; border:1px dashed var(--border); border-radius:12px;">
            <label>Vyber uložený systém (SN)
              <select id="cfgList" style="width:100%; padding:8px; border:1px solid var(--border); border-radius:10px;"></select>
            </label>
            <div style="margin-top:10px; display:flex; gap:8px;">
              <button type="button" id="btnLoadSelected" class="small-btn">Načíst</button>
              <button type="button" id="btnLoadCancel" class="small-btn">Zavřít</button>
            </div>
          </div>

        </fieldset>
      </form>
    </aside>

    <section class="grid">
      <div class="card" id="card-panels">
        <h3>Panely</h3>
        <div class="kv">
          <div class="dim">Celkem</div><div class="bar"><i id="bar-pv-total" style="width:0%"></i></div><div class="pill"><span id="pv-total">0</span> W</div>
          <div class="dim">String 1</div><div class="bar"><i id="bar-pv-1" style="width:0%"></i></div><div class="pill"><span id="pv-1">0</span> W</div>
          <div class="dim">String 2</div><div class="bar"><i id="bar-pv-2" style="width:0%"></i></div><div class="pill"><span id="pv-2">0</span> W</div>
          <div class="dim">Výroba DC dnes</div><div></div><div class="pill"><span id="pv-dc-today">0.0</span> kWh</div>
        </div>
      </div>

      <div class="card" id="card-batt">
        <h3>Baterie</h3>
        <div class="kv">
          <div class="dim">SoC</div><div class="bar"><i id="bar-batt-soc" style="width:0%"></i></div><div class="pill"><span id="batt-soc">0</span> %</div>
          <div class="dim">Teplota</div><div></div><div class="pill"><span id="batt-temp">0</span> °C</div>
          <div class="dim">Energie (zbývající)</div><div class="bar"><i id="bar-batt-cap" style="width:0%"></i></div><div class="pill"><span id="batt-cap">0.0</span> kWh</div>
          <div class="dim">Směr</div><div></div><div id="batt-power" class="pill">0 W</div>
          <div class="dim">Dnes nabito</div><div></div><div class="pill"><span id="batt-in">0.0</span> kWh</div>
          <div class="dim">Dnes vybito</div><div></div><div class="pill"><span id="batt-out">0.0</span> kWh</div>
        </div>
      </div>

      <div class="card" id="card-inv">
        <h3>Střídač <span id="inv-mode" class="dim"></span></h3>
        <div class="kv">
          <div class="dim">Teplota</div><div></div><div class="pill"><span id="inv-temp">0</span> °C</div>
          <div class="dim">Výkon</div><div class="bar"><i id="bar-inv" style="width:0%"></i></div><div class="pill"><span id="inv-pwr">0</span> W</div>
          <div class="dim">L1</div><div></div><div class="pill"><span id="l1">0</span> W</div>
          <div class="dim">L2</div><div></div><div class="pill"><span id="l2">0</span> W</div>
          <div class="dim">L3</div><div></div><div class="pill"><span id="l3">0</span> W</div>
          <div class="dim">AC výroba dnes</div><div></div><div class="pill"><span id="inv-ac-today">0.0</span> kWh</div>
        </div>
      </div>

      <div class="card" id="card-grid">
        <h3>Distribuční síť</h3>
        <div class="kv">
          <div class="dim">Směr</div><div></div><div id="grid-dir" class="pill">0 W</div>
          <div class="dim">Dnes odebráno</div><div></div><div class="pill"><span id="grid-in">0.00</span> kWh</div>
          <div class="dim">Dnes dodáno</div><div></div><div class="pill"><span id="grid-out">0.00</span> kWh</div>
        </div>
      </div>

      <div class="card" id="card-home">
        <h3>Dům</h3>
        <div class="kv">
          <div class="dim">Aktuální odběr</div><div class="bar"><i id="bar-home" style="width:0%"></i></div><div class="pill"><span id="home-load">0</span> W</div>
          <div class="dim">Dnes spotřeba</div><div></div><div class="pill"><span id="home-cons">0.0</span> kWh</div>
          <div class="dim">Soběstačnost</div><div class="bar"><i id="bar-self" style="width:0%"></i></div><div class="pill"><span id="self">0</span> %</div>
        </div>
      </div>

      <div class="card">
        <h3>Systém</h3>
        <div class="kv">
          <div class="dim">Sériové číslo</div><div></div><div class="pill mono" id="sn">—</div>
          <div class="dim">Čas</div><div></div><div class="pill mono" id="dt">—</div>
        </div>
      </div>
    </section>
  </main>
<script src="app.js"></script>


</body>
</html>