<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Solax – živá telemetrie</title>
  
<link rel="stylesheet" href="common.css">
  <!-- Všechny styly nyní v common.css, ale pro přehlednost zde zůstává i základní stylová část -->
  
  <style>
  :root{
    --bg:#0b0f14; --card:#121822; --muted:#99a3b3; --ok:#1f9d55; --bad:#d64545; --accent:#3b82f6;
    --border:#1d2633; --panel:#0e1420; --panel-border:#263148;
    --text:#e8eef7;
  }
  html,body{ margin:0; background:var(--bg); color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif }

  header{ display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:16px 20px; border-bottom:1px solid var(--border) }
  h1{ margin:0; font-size:18px; font-weight:600 } .hdr-meta{ margin-left:10px; color:#c9d7ee; font-weight:500; font-size:14px; opacity:.9 }
  .header-actions{ top:16px; z-index:2001 }

  .small-btn{
    flex:0 0 auto; padding:6px 12px; border-radius:8px; border:none;
    font-weight:600; cursor:pointer; font-size:14px;
    background:#263248; color:#e8eef7; transition:filter .15s ease, background .15s ease;
  }
  .small-btn.ok{ background:var(--ok); color:#fff }
  .small-btn.bad{ background:var(--bad); color:#fff }
  .small-btn[disabled]{ opacity:.7; cursor:not-allowed }
  .small-btn:hover{ filter:brightness(1.07) }

  .icon-btn{
    width:36px; height:36px; flex:0 0 36px; display:inline-flex; align-items:center; justify-content:center;
    border-radius:10px; border:1px solid var(--panel-border);
    background:var(--panel); cursor:pointer; padding:0; box-sizing:border-box;
  }
  .icon-btn:hover{ background:#141c2b }
  .icon-btn:focus{ outline:2px solid var(--accent); outline-offset:2px }
  .icon{ width:28px; height:28px } .icon path{ stroke-width:2.4 }

  main{ display:grid; grid-template-columns:360px 1fr; gap:18px; padding:18px }
  .grid{ display:grid; grid-template-columns:repeat(2,minmax(350px,1fr)); gap:16px }

  .card{ background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px 16px }
  .card h3{ margin:0 0 10px 0; font-size:14px; color:#c9d7ee }
  .kv{ gap:8px 10px; font-size:14px }
  .dim{ color:var(--muted); font-size:12px }
  .pill{ background:var(--panel); border:1px solid var(--panel-border); border-radius:999px; padding:2px 8px }
  .bar{ height:10px; background:var(--panel); border:1px solid #243049 }
  .bar > i{ background: linear-gradient(90deg, var(--accent), #22c55e) }

  .backdrop{ background: rgba(10,15,25,.35); z-index:1500 }
  .sidepanel{ width:340px; background:var(--card); border-left:1px solid var(--border);
    box-shadow:-4px 0 10px rgba(0,0,0,.3); padding:16px; z-index:2000 }
  input{
    width:100%; padding:10px 12px; border-radius:8px;
    border:1px solid #253045; background:var(--panel); color:#e8eef7;
  }
  .row{ gap:10px }

  @media (max-width:980px){ main{ grid-template-columns:1fr } .grid{ grid-template-columns:1fr } }
  @media (max-width:480px){ .small-btn{ padding:5px 10px; font-size:13px } .icon{ width:26px; height:26px } }

  /* (volitelné) tmavší verze pulzu – ponechám default z common.css, ale klidně můžeš navýšit */
</style>


</head>

<body>
  <header>
    <h1>Solax – živá telemetrie <span class="hdr-meta">· <span id="dt">—</span></span></h1>

    <!-- Fixed action group (right top) -->
    <div class="header-actions">
      <a href="frontend_2_light.html" class="icon-btn" >&#127767;</a>
      <button id="start" class="small-btn ok" aria-pressed="false">Start</button>
      <button id="stop"  class="small-btn bad" aria-pressed="false">Stop</button>

      <!-- Toggle settings -->
      <button id="toggleSettings" class="icon-btn" aria-controls="settingsPanel" aria-expanded="false" title="Nastavení">
        <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="#c9d7ee" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </header>

  <main>
    <!-- Backdrop sits under action bar, above page -->
    <div id="panelBackdrop" class="backdrop" hidden></div>

    <!-- Right sliding settings panel -->
    <aside id="settingsPanel" class="sidepanel" hidden>
      <form id="cfg">
        <fieldset>
          <legend>Nastavení</legend>

          <label>API URL (Solax reálné API)
            <input name="apiUrl" placeholder="http://solax-sim" />
          </label>

          <label><input type="checkbox" name="sendPwd" /> Posílat heslo z prohlížeče (nedoporučeno)</label>
          <div id="pwdWrap" style="display:none">
            <label>Heslo k API
              <input name="passwd" type="password" autocomplete="current-password" />
            </label>
          </div>

          <label>Proxy (pokud není Solax http API přímo dostupné)
            <input name="proxy" placeholder="http://some-proxy:3128" />
          </label>

          <div class="row">
            <div>
              <label>Interval čtení (s)
                <input name="delay" type="number" min="1" value="4" />
              </label>
            </div>
            <div>
              <label>Debug (0/1/2)
                <input name="debuglevel" type="number" min="0" max="2" value="1" />
              </label>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Peak String 1 (W)
                <input name="peak1" type="number" min="0" value="4500" />
              </label>
            </div>
            <div>
              <label>Peak String 2 (W)
                <input name="peak2" type="number" min="0" value="0" />
              </label>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Max výkon měniče (W)
                <input name="maxPower" type="number" min="0" value="4500" />
              </label>
            </div>
            <div>
              <label>Max odběr domu (W)
                <input name="maxLoad" type="number" min="0" value="16000" />
              </label>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Max energie baterie (Wh)
                <input name="BatteryMaxCapacity" type="number" min="0" value="10000" />
              </label>
            </div>
          </div>

          <div class="footer">
            Proxy endpoint je napevno <span class="mono">proxy.php</span>. Z bezpečnostních důvodů je lepší, aby <span class="mono">proxy.php</span> heslo doplnila na serveru.
          </div>
          <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap">
            <button type="button" id="btnSaveDb" class="small-btn" style="border:1px solid var(--border)">Uložit do DB</button>
            <button type="button" id="btnLoadDb" class="small-btn" style="border:1px solid var(--border)">Načíst ze DB</button>
          </div>

          <!-- Malý načítací box pro výběr konfigurace -->
          <div id="loadBox" style="display:none; margin-top:10px; padding:10px; border:1px dashed var(--border); border-radius:12px;">
            <label>Vyber uložený systém (SN)
              <select id="cfgList" style="width:100%; padding:8px; border:1px solid var(--border); border-radius:10px;"></select>
            </label>
            <div style="margin-top:10px; display:flex; gap:8px;">
              <button type="button" id="btnLoadSelected" class="small-btn">Načíst</button>
              <button type="button" id="btnLoadCancel" class="small-btn">Zavřít</button>
            </div>
          </div>
        </fieldset>
      </form>
    </aside>

    <!-- DATA CARDS -->
    <section>
      <div class="grid">
        <div class="card" id="card-panels">
          <h3>Panely</h3>
          <div class="kv">
            <div class="dim">Celkem</div><div class="bar"><i id="bar-pv-total" style="width:0%"></i></div><div class="pill"><span id="pv-total">0</span> W</div>
            <div class="dim">String 1</div><div class="bar"><i id="bar-pv-1" style="width:0%"></i></div><div class="pill"><span id="pv-1">0</span> W</div>
            <div class="dim">String 2</div><div class="bar"><i id="bar-pv-2" style="width:0%"></i></div><div class="pill"><span id="pv-2">0</span> W</div>
            <div class="dim">Výroba DC dnes</div><div></div><div class="pill"><span id="pv-dc-today">0.0</span> kWh</div>
          </div>
        </div>

        <div class="card" id="card-batt">
          <h3>Baterie</h3>
          <div class="kv">
            <div class="dim">SoC</div><div class="bar"><i id="bar-batt-soc" style="width:0%"></i></div><div class="pill"><span id="batt-soc">0</span> %</div>
            <div class="dim">Teplota</div><div></div><div class="pill"><span id="batt-temp">0</span> °C</div>
            <div class="dim">Energie (zbývající)</div><div class="bar"><i id="bar-batt-cap" style="width:0%"></i></div><div class="pill"><span id="batt-cap">0.0</span> kWh</div>
            <div class="dim">Směr</div><div></div><div id="batt-power" class="pill">0 W</div>
            <div class="dim">Dnes nabito</div><div></div><div class="pill"><span id="batt-in">0.0</span> kWh</div>
            <div class="dim">Dnes vybito</div><div></div><div class="pill"><span id="batt-out">0.0</span> kWh</div>
          </div>
        </div>

        <div class="card" id="card-inv">
          <h3>Střídač <span id="inv-mode" class="dim"></span></h3>
          <div class="kv">
            <div class="dim">Teplota</div><div></div><div class="pill"><span id="inv-temp">0</span> °C</div>
            <div class="dim">Výkon</div><div class="bar"><i id="bar-inv" style="width:0%"></i></div><div class="pill"><span id="inv-pwr">0</span> W</div>
            <div class="dim">L1</div><div></div><div class="pill"><span id="l1">0</span> W</div>
            <div class="dim">L2</div><div></div><div class="pill"><span id="l2">0</span> W</div>
            <div class="dim">L3</div><div></div><div class="pill"><span id="l3">0</span> W</div>
            <div class="dim">AC výroba dnes</div><div></div><div class="pill"><span id="inv-ac-today">0.0</span> kWh</div>
          </div>
        </div>

        <div class="card" id="card-grid">
          <h3>Distribuční síť</h3>
          <div class="kv">
            <div class="dim">Směr</div><div></div><div id="grid-dir" class="pill">0 W</div>
            <div class="dim">Dnes odebráno</div><div></div><div class="pill"><span id="grid-in">0.00</span> kWh</div>
            <div class="dim">Dnes dodáno</div><div></div><div class="pill"><span id="grid-out">0.00</span> kWh</div>
          </div>
        </div>

        <div class="card" id="card-home">
          <h3>Dům</h3>
          <div class="kv">
            <div class="dim">Aktuální odběr</div><div class="bar"><i id="bar-home" style="width:0%"></i></div><div class="pill"><span id="home-load">0</span> W</div>
            <div class="dim">Dnes spotřeba</div><div></div><div class="pill"><span id="home-cons">0.0</span> kWh</div>
            <div class="dim">Soběstačnost</div><div class="bar"><i id="bar-self" style="width:0%"></i></div><div class="pill"><span id="self">0</span> %</div>
          </div>
        </div>

        <div class="card">
          <h3>Systém</h3>
          <div class="kv">
            <div class="dim">Sériové číslo</div><div></div><div class="pill mono" id="sn">—</div>
            <div class="dim">Režim</div><div></div><div class="pill"><span id="inv-mode2">—</span></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
