# --- Dockerfile ---
FROM php:8.2-apache

WORKDIR /var/www/html

# zabuduj výchozí soubory (funguje i bez volume)
COPY www/index.php /var/www/html/index.php
COPY www/health.php /var/www/html/health.php
COPY www/data.json /var/www/html/data.json

# vytvoř zapisovatelný stav
RUN mkdir -p /var/www/html/state && chown -R www-data:www-data /var/www/html/state

EXPOSE 80

HEALTHCHECK --interval=30s --timeout=3s --retries=3 \
  CMD curl -sf http://localhost/health.php || exit 1

